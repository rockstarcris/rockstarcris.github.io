import{d as u,s as _,l as w,q as m}from"./index.esm.098bce7e.js";import{c as f,p as c}from"./cargando.store.d89b5574.js";import{g as p}from"./navigation.b493bfee.js";const l=(t,e=500)=>{let r;return(...s)=>{clearTimeout(r),r=setTimeout(()=>{t.apply(void 0,s)},e)}},g=(t,e,r,s)=>new Promise((i,a)=>{const d=u.subscribe(async o=>{if(o){try{l(async()=>{!s&&await b()},1e4),await _(w(o,t,e),r),i()}catch(n){a(n)}d()}})}),y=async t=>{var e;try{const r=o=>{f.update(n=>(n.perfil=o,n))},s=sessionStorage.getItem("user_id");if(!s){c.set(void 0),r(!1),!["/ingreso","/registro"].includes(t)&&p("/");return}const i=s&&((e=await m("sesiónes","id",s))==null?void 0:e[0]),a=i==null?void 0:i.tiempo_de_expiración;if(a&&new Date().getTime()>=a)throw sessionStorage.removeItem("user_id"),c.set(void 0),r(!1),p("/"),new Error("La sesión está vencida.");{const o=(await m("usuarios","id",s))[0];c.set(o),r(!1)}return i}catch(r){throw new Error(r)}},b=async t=>{try{const e=await y(t);e&&await g("sesiónes",e.id,{...e,tiempo_de_expiración:new Date().getTime()+36e5})}catch(e){throw new Error(e)}};export{l as d,b as m,g as p};
